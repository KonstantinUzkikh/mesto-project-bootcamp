(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){"Escape"===e.key&&(r(),e.target.blur())}function n(e){e.classList.add("popup_opened"),setTimeout((function(){e.classList.remove("popup_disappearance"),e.classList.add("popup_appearance")}),100),document.addEventListener("keydown",t)}function r(){var e=document.querySelector(".popup_opened");e.classList.remove("popup_appearance"),e.classList.add("popup_disappearance"),setTimeout((function(){e.classList.remove("popup_opened")}),700),document.removeEventListener("keydown",t)}function o(e,t,n){var r=e.querySelector(".popup__input-error_".concat(t.id));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function c(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){return o(e,n,t)}))}function a(e,t,n){t?(e.removeAttribute("disabled"),e.classList.remove(n.inactiveButtonClass)):(e.setAttribute("disabled",!0),e.classList.add(n.inactiveButtonClass))}e.d({},{x:()=>K,N:()=>I});var u={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-3",headers:{authorization:"29081990-548c-4f14-9b01-8d4a7169b3f0","Content-Type":"application/json"}};function i(e,t){e.textContent=t}var l,s=document.querySelector("#card-template").content,p=document.querySelector(".elements__cards-list"),d=document.querySelector(".popup_magnification-image"),f=d.querySelector(".popup__big-image"),_=d.querySelector(".popup__title-big-image"),m=document.querySelector(".popup_confirmation-action"),v=m.querySelector(".popup__button-submit");function h(e){var t=s.querySelector(".elements__card-item").cloneNode(!0);e.refDOM=t;var r=t.querySelector(".card__image"),o=t.querySelector(".card__title"),c=t.querySelector(".card__counter-likes"),a=t.querySelector(".card__button-like"),p=t.querySelector(".card__button-delete"),h=t.querySelector(".card__button-image");return o.textContent=e.name,r.src=e.link,r.alt="Фотография: "+e.name,0!=e.likes.length&&(c.textContent="".concat(e.likes.length),e.likes.some((function(e){return e===I._id}))&&a.classList.add("card__button-like_active")),a.addEventListener("click",(function(){return function(e){var t,n;(t=e.likes.some((function(e){return e===I._id}))?"DELETE":"PUT",n=e.card_id,fetch("".concat(u.baseUrl,"/cards/likes/").concat(n),{method:"".concat(t),headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(){alert("УПС... ОШИБКА ЗАПИСИ/УДАЛЕНИЯ ЛАЙКА")}))).then((function(t){e.likes=t.likes.map((function(e){return e._id})),e.likes.length>0?e.refDOM.querySelector(".card__counter-likes").textContent=e.likes.length:e.refDOM.querySelector(".card__counter-likes").textContent="",e.refDOM.querySelector(".card__button-like").classList.toggle("card__button-like_active")})).catch((function(){alert("УПС... ОШИБКА ПРОСТАВЛЕНИЯ ЛАЙКА")}))}(e)})),e.owner_id===I._id&&(p.classList.add("card__button-delete_active"),p.addEventListener("click",(function(){return function(e){l=e,i(v,"Да"),n(m)}(e)}))),h.addEventListener("click",(function(){return function(e){_.textContent=e.name,f.src=e.link,f.alt="Фотография: "+e.name,n(d)}(e)})),t}function y(e){p.prepend(e)}v.addEventListener("click",(function(e){var t;e.preventDefault(e),i(v,"Удаление..."),(t=l.card_id,fetch("".concat(u.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(){alert("УПС... ОШИБКА УДАЛЕНИЯ КАРТОЧКИ")}))).then((function(){var e;K.some((function(t,n){t.card_id===l.card_id&&(e=n)})),K[e].refDOM.remove(),K.splice(e,1)})).catch((function(){alert("УПС... ОШИБКА УДАЛЕНИЯ КАРТОЧКИ")})).finally((function(){r()}))}));var b=document.querySelectorAll(".popup"),S=document.querySelectorAll(".popup__button-close");b.forEach((function(e){e.addEventListener("mousedown",(function(e){e.target.classList.contains("popup")&&r()}))})),S.forEach((function(e){e.closest(".popup"),e.addEventListener("click",(function(){return r()}))}));var k=document.querySelector(".profile__container"),q=k.querySelector(".profile__avatar"),E=k.querySelector(".profile__name"),L=k.querySelector(".profile__activity"),g=k.querySelector(".profile__button-edit"),C=document.querySelector(".popup_editing-profile"),j=C.querySelector(".popup__form_profile"),x=j.querySelector(".popup__input_profile-name"),P=j.querySelector(".popup__input_profile-activity"),A=j.querySelector(".popup__button-submit_profile");g.addEventListener("click",(function(){x.value=E.textContent,P.value=L.textContent,c(j,F),i(A,"Сохранить"),a(A,!0,F),n(C)})),j.addEventListener("submit",(function(e){e.preventDefault(e),x.value!=I.name||P.value!=I.about?(i(A,"Сохранение..."),function(e,t){return fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(){alert("УПС... ОШИБКА ЗАПИСИ ПРОФИЛЯ")}))}(x.value,P.value).then((function(e){E.textContent=e.name,L.textContent=e.about,I.name=e.name,I.about=e.about})).catch((function(){alert("УПС... ОШИБКА ОБНОВЛЕНИЯ ПРОФИЛЯ")})).finally((function(){r()}))):r()}));var O=document.querySelector(".profile__button-add-card"),w=document.querySelector(".popup_creating-card"),D=w.querySelector(".popup__form_card"),T=D.querySelector(".popup__input_card-name"),U=D.querySelector(".popup__input_card-url"),M=D.querySelector(".popup__button-submit_card");O.addEventListener("click",(function(){i(M,"Создать"),n(w)})),D.addEventListener("submit",(function(e){e.preventDefault(e);var t={name:T.value,link:U.value};i(M,"Сохранение..."),function(e){return fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(){alert("УПС... ОШИБКА ЗАПИСИ КАРТОЧКИ")}))}(t).then((function(t){var n={name:t.name,link:t.link,owner_id:t.owner._id,card_id:t._id,likes:t.likes.map((function(e){return e._id}))};K.push(n),y(h(n)),e.target.reset(),a(M,!1,F)})).catch((function(){alert("УПС... ОШИБКА ДОБАВЛЕНИЯ КАРТОЧКИ")})).finally((function(){r()}))}));var B=k.querySelector(".profile__button-avatar"),N=document.querySelector(".popup_editing-avatar"),J=N.querySelector(".popup__form_avatar"),G=N.querySelector(".popup__input_avatar-url"),H=N.querySelector(".popup__button-submit_avatar");B.addEventListener("click",(function(){G.value=q.src,c(J,F),i(H,"Сохранить"),a(H,!0,F),n(N)})),J.addEventListener("submit",(function(e){var t;e.preventDefault(e),G.value!=I.avatar?(i(H,"Сохранение..."),(t="".concat(G.value),fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(){alert("УПС... ОШИБКА ЗАПИСИ АВАТАРА")}))).then((function(e){q.src=e.avatar,I.avatar=e.avatar})).catch((function(e){alert("УПС... Проверьте корректность ссылки: ".concat(G.value))})).finally((function(){r()}))):r()}));var z,F={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button-submit_disabled",inputErrorClass:"popup__input_type-error",errorClass:"popup__input-error_visible"};z=F,Array.from(document.querySelectorAll(z.formSelector)).forEach((function(e){return function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?o(e,t,n):function(e,t,n){var r=e.querySelector(".popup__input-error_".concat(t.id));r.textContent=t.validationMessage,r.classList.add(n.errorClass),t.classList.add(n.inputErrorClass)}(e,t,n)}(e,c,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?a(t,!0,n):a(t,!1,n)}(n,r,t)}))}))}(e,z)}));var I={};fetch("".concat(u.baseUrl,"/users/me"),{method:"GET",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(){alert("УПС... ОШИБКА ЧТЕНИЯ ПРОФИЛЯ")})).then((function(e){return I=e})).catch((function(){return I={about:"Исследователь океана",avatar:"./images/jyc.jpg",cohort:"wbf-cohort-3",name:"Жак-Ив Кусто",_id:""},alert("УПС... ОШИБКА ИНИЦИАЛИЗАЦИИ ПРОФИЛЯ"),I})).finally((function(){q.src=I.avatar,E.textContent=I.name,L.textContent=I.about}));var K=[];fetch("".concat(u.baseUrl,"/cards"),{method:"GET",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(){alert("УПС... ОШИБКА ЧТЕНИЯ КАРТОТЕКИ")})).then((function(e){(K=e.map((function(e){return{name:e.name,link:e.link,owner_id:e.owner._id,card_id:e._id,likes:e.likes.map((function(e){return e._id}))}}))).forEach((function(e){y(h(e))}))})).catch((function(){alert("УПС... ОШИБКА ИНИЦИАЛИЗАЦИИ КАРТОТЕКИ")}))})();